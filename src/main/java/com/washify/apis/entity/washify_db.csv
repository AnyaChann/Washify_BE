Table Name                  , Description                                       , Key Columns                                                                                              , Foreign Keys                                                        , Notes
branches                    , Chi nhánh cửa tiệm giặt là                    , "id, name, address, phone, manager_name, is_active, created_at, updated_at, deleted_at"                  ,                                                                     , "Hỗ trợ Soft Delete. Tạo trước users vì users có FK tới branches"
users                       , Thông tin tài khoản khách hàng / nhân viên / admin, "id, full_name, username, email, password, phone, address, is_active, require_password_change, require_email_verification_for_password_change, created_at, updated_at, deleted_at, branch_id", "branch_id → branches.id"                                           , "Hỗ trợ Soft Delete. Có username riêng để login. Guest User cần đổi password lần đầu"
roles                       , Danh sách vai trò người dùng                  , "id, name, description"                                                                                  ,                                                                     , "ADMIN / STAFF / CUSTOMER / GUEST"
user_roles                  , Bảng nối Users ↔ Roles                        , "user_id, role_id"                                                                                       , "user_id → users.id; role_id → roles.id"                            , "Quan hệ N:N giữa users và roles"
services                    , Danh mục dịch vụ giặt là                      , "id, name, description, price, estimated_time, is_active, created_at, updated_at, deleted_at"            ,                                                                     , "Hỗ trợ Soft Delete. Giá có thể tính theo kg hoặc item"
orders                      , Đơn hàng của khách hàng                       , "id, order_code, user_id, branch_id, order_date, status, total_amount, notes, deleted_at"               , "user_id → users.id; branch_id → branches.id"                       , "Hỗ trợ Soft Delete. Có order_code duy nhất (VD: WF202510210001). Một order có 1 payment và 0..1 shipment"
order_items                 , Chi tiết từng dịch vụ trong đơn               , "id, order_id, service_id, quantity, price"                                                              , "order_id → orders.id; service_id → services.id"                    , "Một order có nhiều order_items"
payments                    , Thông tin thanh toán cho đơn hàng             , "id, order_id, payment_method, payment_status, payment_date, amount, transaction_id, payment_url, qr_code, gateway_response", "order_id → orders.id (UNIQUE)"                                     , "Mỗi order chỉ có 1 payment. Hỗ trợ CASH và MOMO. Lưu QR code và response từ gateway"
shippers                    , Thông tin shipper nội bộ hoặc đối tác         , "id, name, phone, vehicle_number, is_active, created_at, updated_at, deleted_at"                         ,                                                                     , "Hỗ trợ Soft Delete. Shipper giao hàng tận nơi"
shipments                   , Thông tin giao hàng tận nơi                   , "id, order_id, user_id, shipper_id, address, delivery_status, delivery_date, shipper_name, shipper_phone, created_at, updated_at", "order_id → orders.id; user_id → users.id; shipper_id → shippers.id", "Mỗi order có tối đa 1 shipment. Cache shipper_name và shipper_phone"
reviews                     , Đánh giá đơn hàng                             , "id, order_id, user_id, rating, comment, created_at"                                                     , "order_id → orders.id; user_id → users.id"                          , "1 user có thể review 1 order. Rating từ 1-5 sao"
promotions                  , Mã giảm giá / khuyến mãi                      , "id, code, description, discount_type, discount_value, start_date, end_date, is_active, created_at, updated_at, deleted_at", ,                                                                     , "Hỗ trợ Soft Delete. Có thể dùng % (PERCENT) hoặc giá cố định (FIXED)"
order_promotions            , Bảng nối Orders ↔ Promotions                  , "order_id, promotion_id"                                                                                 , "order_id → orders.id; promotion_id → promotions.id"                , "Quan hệ N:N giữa orders và promotions"
notifications               , Thông báo gửi cho người dùng                  , "id, user_id, title, message, type, related_id, is_read, read_at, created_at"                           , "user_id → users.id"                                                , "Thông báo đơn hàng, thanh toán, giao hàng. Có type và related_id để link tới entity liên quan"
audit_log                   , Nhật ký hoạt động (Audit Trail)               , "id, user_id, entity_type, entity_id, action, old_value, new_value, ip_address, user_agent, description, status, error_message, created_at", "user_id → users.id"                                                , "Ghi nhận tự động mọi thay đổi dữ liệu quan trọng với AOP. Hỗ trợ 30+ operations từ OrderService, UserService, PaymentService, PromotionService, ShipperService, SoftDeleteService. Lưu IP address, User Agent để audit security"
attachments                 , File đính kèm / hình ảnh                      , "id, order_id, shipment_id, file_url, file_type, uploaded_at"                                            , "order_id → orders.id; shipment_id → shipments.id"                  , "Dùng cho ảnh hoá đơn, biên nhận, chứng từ"
password_reset_tokens       , Token để reset mật khẩu                       , "id, user_id, token, expiry_date, is_used, created_at"                                                   , "user_id → users.id"                                                , "Token 1 lần để reset password qua email"
password_change_tokens      , Token để đổi mật khẩu                         , "id, user_id, token, expiry_date, is_used, created_at"                                                   , "user_id → users.id"                                                , "Token 1 lần cho Guest User đổi password lần đầu"
password_change_2fa_tokens  , Token xác thực 2 lớp khi đổi mật khẩu         , "id, user_id, token, expiry_date, is_verified, created_at"                                               , "user_id → users.id"                                                , "Token xác thực email trước khi đổi password (tùy chọn bật/tắt)"
